<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>æ›¼é™€ç¾…ä¹å®®æ ¼ç”Ÿæˆå™¨ (Mandala Chart)</title>
    <meta name="description" content="Free online Mandala Chart generator with auto-scatter logic, dopamine colors, and multilingual support. Visualizes your goals into actionable plans. å…è²»ç·šä¸Šæ›¼é™€ç¾…ä¹å®®æ ¼ç”Ÿæˆå™¨ï¼Œæ”¯æ´ä¸­è‹±åˆ‡æ›ã€è‡ªå‹•æ•£å°„é€£å‹•èˆ‡è±å¯Œé…è‰²ã€‚">
    <meta name="keywords" content="Mandala Chart, æ›¼é™€ç¾…ä¹å®®æ ¼, Goal Setting, ç›®æ¨™ç®¡ç†, M-1 Chart, ä¹å®®æ ¼æ€è€ƒæ³•">
    <meta name="author" content="Nova & Gemini Pro">
    
    <meta property="og:title" content="Mandala Chart Generator (æ›¼é™€ç¾…ä¹å®®æ ¼)">
    <meta property="og:description" content="Visualize your goals with this free, interactive Mandala Chart tool. Supports English & Chinese.">
    <meta property="og:type" content="website">

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "Mandala Chart Generator",
      "applicationCategory": "ProductivityApplication",
      "operatingSystem": "Web",
      "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" },
      "description": "A bilingual (English/Chinese) online tool for creating Mandala Charts with automatic goal scattering feature.",
      "featureList": "Auto-scatter, Multilingual, Dopamine Colors, RWD, Image Download"
    }
    </script>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect x=%225%22 y=%225%22 width=%2290%22 height=%2290%22 rx=%2215%22 fill=%22%236366f1%22/><path d=%22M30 30h40M30 50h40M30 70h40M30 30v40M50 30v40M70 30v40%22 stroke=%22white%22 stroke-width=%228%22 stroke-linecap=%22round%22/></svg>">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --bg-color: #f8fafc;
            --grid-border-color: #475569;
            --thick-border-color: #1e293b;
            --font-size-s: 0.8rem;
            --font-size-m: 1rem;
            --font-size-l: 1.3rem;
            --font-size-xl: 1.6rem;
            --current-font-size: var(--font-size-m);
        }

        body {
            font-family: "Microsoft JhengHei", "Heiti TC", "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            color: #333;
            padding-bottom: 80px;
        }

        .header-row {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            width: 100%;
            max-width: 950px;
            margin-bottom: 15px;
        }

        h1 { margin: 0; color: #334155; font-size: 1.8rem; font-weight: 700; text-align: center; }

        /* èªè¨€åˆ‡æ›æŒ‰éˆ• */
        .lang-switch {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            background: white;
            border: 1px solid #cbd5e1;
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            color: #475569;
            font-weight: 600;
        }
        .lang-switch:hover { background: #f1f5f9; color: #6366f1; border-color: #6366f1; }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.06);
            margin-bottom: 25px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: flex-start;
            justify-content: center;
            max-width: 950px;
            width: 100%;
            box-sizing: border-box;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center;
        }
        
        .control-label { font-size: 0.85rem; color: #64748b; font-weight: 600; }

        .btn-group { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; }

        button {
            padding: 6px 14px;
            border: 1px solid #cbd5e1;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
            color: #475569;
        }

        button:hover { background: #f1f5f9; }
        button.active { background: #6366f1; color: white; border-color: #6366f1; }
        .btn-primary { background: #6366f1; color: white; border: none; }
        .btn-outline { border: 1px solid #6366f1; color: #6366f1; }

        .color-picker-wrapper { display: flex; flex-direction: column; gap: 10px; }
        .palette-row { display: flex; align-items: center; gap: 6px; justify-content: center; flex-wrap: wrap; }
        .palette-name { font-size: 0.75rem; color: #94a3b8; width: 60px; text-align: right; margin-right: 4px; }
        
        .color-swatch {
            width: 24px; height: 24px; border-radius: 5px; cursor: pointer;
            border: 2px solid transparent; transition: transform 0.1s;
        }
        .color-swatch:hover { transform: scale(1.15); border-color: rgba(0,0,0,0.2); }
        .custom-picker-row { display: flex; align-items: center; justify-content: flex-end; gap: 8px; padding-top: 5px; border-top: 1px dashed #e2e8f0; }

        #mandala-container-wrapper {
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            max-width: 800px;
            width: 100%;
            overflow: visible; 
            margin-bottom: 40px;
        }

        #mandala-container {
            border: 3px solid var(--thick-border-color);
            background-color: var(--grid-border-color);
            width: 100%;
            box-sizing: border-box;
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 1px;
        }

        .cell {
            position: relative;
            background: white;
            display: flex; align-items: center; justify-content: center;
            min-height: 60px; 
            aspect-ratio: 1 / 1; 
            font-size: var(--current-font-size);
            font-weight: 500;
            box-sizing: border-box; 
        }

        @media (max-width: 600px) {
            .cell { aspect-ratio: auto; min-height: 50px; }
        }

        .cell.thick-right { border-right: 3px solid var(--thick-border-color); z-index: 1; }
        .cell.thick-bottom { border-bottom: 3px solid var(--thick-border-color); z-index: 1; }

        .editable-div {
            width: 100%; height: 100%; min-height: 100%;
            border: none; text-align: center; background: transparent;
            padding: 2px; box-sizing: border-box; outline: none;
            display: flex; align-items: center; justify-content: center;
            word-break: break-all; white-space: pre-wrap; 
            font-family: inherit; color: inherit; line-height: 1.3; 
        }

        .editable-div:empty::before {
            content: attr(data-placeholder);
            color: inherit; opacity: 0.4; pointer-events: none;
        }

        #fileInput { display: none; }

        .guide-section {
            max-width: 800px;
            width: 90%;
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.04);
            color: #475569;
            line-height: 1.7;
        }

        .guide-section h2 { font-size: 1.5rem; color: #334155; margin-bottom: 20px; border-bottom: 2px solid #e2e8f0; padding-bottom: 10px; }
        .guide-section h3 { font-size: 1.1rem; color: #6366f1; margin-top: 25px; margin-bottom: 10px; }
        .guide-section p, .guide-section li { margin-bottom: 10px; font-size: 1rem; }
        .guide-section ul, .guide-section ol { padding-left: 20px; }
        .feature-tag { display: inline-block; background: #eef2ff; color: #6366f1; padding: 2px 8px; border-radius: 4px; font-size: 0.85rem; margin-right: 5px; font-weight: 500; }

        @media (max-width: 600px) {
            body { padding: 10px; padding-bottom: 150px; }
            .header-row { flex-direction: column; gap: 10px; }
            .lang-switch { position: static; transform: none; align-self: flex-end; margin-right: 10px;}
            .controls { padding: 15px; gap: 15px; }
            .palette-name { display: none; }
            #mandala-container-wrapper { padding: 5px; }
            .guide-section { padding: 25px; width: 100%; box-sizing: border-box; }
            :root { --font-size-s: 0.7rem; --font-size-m: 0.9rem; --font-size-l: 1.1rem; --font-size-xl: 1.3rem; }
        }
    </style>
</head>
<body>

    <div class="header-row">
        <h1 data-i18n="title">æ›¼é™€ç¾…ä¹å®®æ ¼ç”Ÿæˆå™¨</h1>
        <button class="lang-switch" onclick="toggleLanguage()">En / ä¸­æ–‡</button>
    </div>

    <div class="controls">
        <div class="control-group">
            <span class="control-label" data-i18n="fontSize">å­—é«”å¤§å°</span>
            <div class="btn-group" id="fontSizeControls">
                <button onclick="setFontSize('s')" id="btn-fs-s" data-i18n="fsS">å°</button>
                <button onclick="setFontSize('m')" id="btn-fs-m" class="active" data-i18n="fsM">ä¸­</button>
                <button onclick="setFontSize('l')" id="btn-fs-l" data-i18n="fsL">å¤§</button>
                <button onclick="setFontSize('xl')" id="btn-fs-xl" data-i18n="fsXL">ç‰¹å¤§</button>
            </div>
        </div>

        <div class="control-group">
            <span class="control-label" data-i18n="colorStyle">é¢¨æ ¼è‰²ç³» (å…ˆé¸è‰² â†’ å†é»å€å¡Šä¸­å¿ƒ)</span>
            <div class="color-picker-wrapper">
                <div class="palette-row">
                    <span class="palette-name" data-i18n="pMacaron">é¦¬å¡é¾</span>
                    <div class="color-swatch" style="background: #FF9999;" onclick="pickColor('#FF9999')"></div>
                    <div class="color-swatch" style="background: #FFCC99;" onclick="pickColor('#FFCC99')"></div>
                    <div class="color-swatch" style="background: #FFF599;" onclick="pickColor('#FFF599')"></div>
                    <div class="color-swatch" style="background: #B8FFB8;" onclick="pickColor('#B8FFB8')"></div>
                    <div class="color-swatch" style="background: #99FFFF;" onclick="pickColor('#99FFFF')"></div>
                    <div class="color-swatch" style="background: #99CCFF;" onclick="pickColor('#99CCFF')"></div>
                    <div class="color-swatch" style="background: #CC99FF;" onclick="pickColor('#CC99FF')"></div>
                    <div class="color-swatch" style="background: #FF99CC;" onclick="pickColor('#FF99CC')"></div>
                </div>
                <div class="palette-row">
                    <span class="palette-name" data-i18n="pDopamine">å¤šå·´èƒº</span>
                    <div class="color-swatch" style="background: #FF0055;" onclick="pickColor('#FF0055')"></div>
                    <div class="color-swatch" style="background: #FF5500;" onclick="pickColor('#FF5500')"></div>
                    <div class="color-swatch" style="background: #FFDD00;" onclick="pickColor('#FFDD00')"></div>
                    <div class="color-swatch" style="background: #00FF33;" onclick="pickColor('#00FF33')"></div>
                    <div class="color-swatch" style="background: #00DDFF;" onclick="pickColor('#00DDFF')"></div>
                    <div class="color-swatch" style="background: #0055FF;" onclick="pickColor('#0055FF')"></div>
                    <div class="color-swatch" style="background: #AA00FF;" onclick="pickColor('#AA00FF')"></div>
                    <div class="color-swatch" style="background: #FF00AA;" onclick="pickColor('#FF00AA')"></div>
                </div>
                <div class="palette-row">
                    <span class="palette-name" data-i18n="pMorandi">è«è˜­è¿ª</span>
                    <div class="color-swatch" style="background: #D3C4BE;" onclick="pickColor('#D3C4BE')"></div>
                    <div class="color-swatch" style="background: #B4A5A5;" onclick="pickColor('#B4A5A5')"></div>
                    <div class="color-swatch" style="background: #8C9A9E;" onclick="pickColor('#8C9A9E')"></div>
                    <div class="color-swatch" style="background: #989F86;" onclick="pickColor('#989F86')"></div>
                    <div class="color-swatch" style="background: #B0A695;" onclick="pickColor('#B0A695')"></div>
                    <div class="color-swatch" style="background: #7E8088;" onclick="pickColor('#7E8088')"></div>
                    <div class="color-swatch" style="background: #A79086;" onclick="pickColor('#A79086')"></div>
                    <div class="color-swatch" style="background: #606c78;" onclick="pickColor('#606c78')"></div>
                </div>
                <div class="palette-row">
                    <span class="palette-name" data-i18n="pEarth">å¤§åœ°è‰²</span>
                    <div class="color-swatch" style="background: #D4A373;" onclick="pickColor('#D4A373')"></div>
                    <div class="color-swatch" style="background: #CCD5AE;" onclick="pickColor('#CCD5AE')"></div>
                    <div class="color-swatch" style="background: #E9EDC9;" onclick="pickColor('#E9EDC9')"></div>
                    <div class="color-swatch" style="background: #FAEDCD;" onclick="pickColor('#FAEDCD')"></div>
                    <div class="color-swatch" style="background: #A98467;" onclick="pickColor('#A98467')"></div>
                    <div class="color-swatch" style="background: #6C584C;" onclick="pickColor('#6C584C')"></div>
                    <div class="color-swatch" style="background: #588157;" onclick="pickColor('#588157')"></div>
                    <div class="color-swatch" style="background: #3A5A40;" onclick="pickColor('#3A5A40')"></div>
                </div>
                <div class="custom-picker-row">
                    <span style="font-size: 0.8rem; color:#888;" data-i18n="customColor">è‡ªè¨‚é¡è‰²:</span>
                    <input type="color" id="colorPicker" value="#6366f1" style="cursor: pointer; height: 24px; width: 40px; padding: 0; border: 1px solid #ccc; border-radius: 4px;">
                </div>
            </div>
        </div>

        <div class="control-group">
            <span class="control-label" data-i18n="actions">å­˜å–èˆ‡ä¸‹è¼‰</span>
            <div class="btn-group">
                <button class="btn-outline" onclick="exportData()" data-i18n="btnExport">åŒ¯å‡º</button>
                <button class="btn-outline" onclick="document.getElementById('fileInput').click()" data-i18n="btnImport">åŒ¯å…¥</button>
                <button class="btn-primary" onclick="downloadImage()" data-i18n="btnDownload">ä¸‹è¼‰åœ–ç‰‡</button>
            </div>
        </div>
    </div>

    <input type="file" id="fileInput" accept=".json" onchange="importData(this)">

    <div id="mandala-container-wrapper">
        <div id="mandala-container" id="mainGrid"></div>
    </div>

    <article class="guide-section" id="guideSection">
        </article>

    <script>
        // --- ç¿»è­¯è³‡æº (i18n Resources) ---
        const translations = {
            zh: {
                title: 'æ›¼é™€ç¾…ä¹å®®æ ¼ç”Ÿæˆå™¨',
                fontSize: 'å­—é«”å¤§å°',
                fsS: 'å°', fsM: 'ä¸­', fsL: 'å¤§', fsXL: 'ç‰¹å¤§',
                colorStyle: 'é¢¨æ ¼è‰²ç³» (å…ˆé¸è‰² â†’ å†é»å€å¡Šä¸­å¿ƒ)',
                pMacaron: 'é¦¬å¡é¾', pDopamine: 'å¤šå·´èƒº', pMorandi: 'è«è˜­è¿ª', pEarth: 'å¤§åœ°è‰²',
                customColor: 'è‡ªè¨‚é¡è‰²:',
                actions: 'å­˜å–èˆ‡ä¸‹è¼‰',
                btnExport: 'åŒ¯å‡º', btnImport: 'åŒ¯å…¥', btnDownload: 'ä¸‹è¼‰åœ–ç‰‡',
                coreGoal: 'æ ¸å¿ƒç›®æ¨™', subGoal: 'æ¬¡ç›®æ¨™',
                alertImportSuccess: 'åŒ¯å…¥æˆåŠŸ', alertFormatError: 'æ ¼å¼éŒ¯èª¤', alertFileError: 'æª”æ¡ˆéŒ¯èª¤',
                guideHTML: `
                    <h2>ä»€éº¼æ˜¯æ›¼é™€ç¾…ä¹å®®æ ¼ (Mandala Chart)ï¼Ÿ</h2>
                    <p>æ›¼é™€ç¾…æ€è€ƒæ³•ï¼ˆMandala Chartï¼‰ï¼Œåˆç¨±ç‚ºä¹å®®æ ¼æ€è€ƒæ³•ï¼Œæ˜¯ä¸€ç¨®å¼·å¤§çš„è¦–è¦ºåŒ–ç›®æ¨™é”æˆå·¥å…·ã€‚é€éå°‡ä¸€å€‹æ ¸å¿ƒä¸»é¡Œæ‹†è§£ç‚º 8 å€‹æ¬¡ç´šç›®æ¨™ï¼Œå†å°‡æ¯å€‹æ¬¡ç´šç›®æ¨™å»¶ä¼¸å‡º 8 å€‹å…·é«”è¡Œå‹•ï¼Œæœ€çµ‚å½¢æˆ 64 å€‹å¯åŸ·è¡Œçš„è¨ˆç•«ã€‚</p>
                    <p>é€™å€‹å·¥å…·ç”± Nova's Tool é–‹ç™¼ï¼Œæ—¨åœ¨æä¾›ä¸€å€‹å…è²»ã€ç„¡å»£å‘Šä¸”é«˜åº¦å®¢è£½åŒ–çš„ç·šä¸Šä½¿ç”¨é«”é©—ã€‚</p>
                    <h3>âœ¨ æœ¬å·¥å…·ç‰¹è‰²</h3>
                    <p>
                        <span class="feature-tag">ç›®æ¨™è‡ªå‹•æ•£å°„é€£å‹•</span>
                        <span class="feature-tag">æ™ºèƒ½èª¿æ•´æ–‡å­—æ·±æ·ºå°æ¯”</span>
                        <span class="feature-tag">å¤šå·´èƒº/è«è˜­è¿ªé…è‰²</span>
                        <span class="feature-tag">RWDå®Œç¾æ”¯æ´</span>
                    </p>
                    <h3>ğŸš€ å¦‚ä½•ä½¿ç”¨æ­¤ç”Ÿæˆå™¨</h3>
                    <ol>
                        <li><strong>è¨­å®šæ ¸å¿ƒç›®æ¨™ï¼š</strong>é»æ“Šæ­£ä¸­å¤®çš„ä¹å®®æ ¼ä¸­å¿ƒï¼Œè¼¸å…¥æ‚¨ä»Šå¹´çš„å¹´åº¦é—œéµå­—æˆ–ä¸»è¦ç›®æ¨™ã€‚</li>
                        <li><strong>æ“´å±•æ¬¡ç´šç›®æ¨™ï¼š</strong>åœ¨æ ¸å¿ƒç›®æ¨™å‘¨åœçš„ 8 å€‹æ ¼å­è¼¸å…¥æ¬¡ç´šç›®æ¨™ã€‚ç³»çµ±æœƒè‡ªå‹•å°‡é€™äº›å…§å®¹ã€Œæ•£å°„ã€åˆ°å¤–åœå°æ‡‰ä¹å®®æ ¼çš„ä¸­å¿ƒé»ã€‚</li>
                        <li><strong>è¦åŠƒè¡Œå‹•æ–¹æ¡ˆï¼š</strong>åœ¨å¤–åœçš„æ¯å€‹ä¹å®®æ ¼ä¸­ï¼Œå¡«å¯«ç‚ºäº†é”æˆè©²æ¬¡ç´šç›®æ¨™æ‰€éœ€çš„ 8 å€‹å…·é«”è¡Œå‹•ã€‚</li>
                        <li><strong>è‡ªè¨‚é¢¨æ ¼ï¼š</strong>ä½¿ç”¨ä¸Šæ–¹çš„è‰²ç¥¨å·¥å…·ï¼Œé»é¸å–œæ­¡çš„é¡è‰²å¾Œï¼Œå†é»æ“Šä»»ä¸€ã€Œå€å¡Šä¸­å¿ƒã€ï¼Œå³å¯ä¸€éµåˆ‡æ›è©²å€å¡Šçš„è‰²ç³»ã€‚</li>
                        <li><strong>ä¿å­˜æˆæœï¼š</strong>å®Œæˆå¾Œï¼Œæ‚¨å¯ä»¥é¸æ“‡ã€Œä¸‹è¼‰åœ–ç‰‡ã€ä¿å­˜ç‚º PNGï¼Œæˆ–ä½¿ç”¨ã€ŒåŒ¯å‡ºã€åŠŸèƒ½ä¿å­˜ JSON æª”ä»¥ä¾¿æ—¥å¾Œç·¨è¼¯ã€‚</li>
                    </ol>
                `
            },
            en: {
                title: 'Mandala Chart Generator',
                fontSize: 'Font Size',
                fsS: 'Small', fsM: 'Medium', fsL: 'Large', fsXL: 'X-Large',
                colorStyle: 'Color Style (Pick Color â†’ Click Center Block)',
                pMacaron: 'Macaron', pDopamine: 'Dopamine', pMorandi: 'Morandi', pEarth: 'Earth',
                customColor: 'Custom:',
                actions: 'Actions',
                btnExport: 'Export', btnImport: 'Import', btnDownload: 'Download',
                coreGoal: 'Core Goal', subGoal: 'Sub Goal',
                alertImportSuccess: 'Import Successful!', alertFormatError: 'Invalid Format', alertFileError: 'File Error',
                guideHTML: `
                    <h2>What is a Mandala Chart?</h2>
                    <p>The Mandala Chart (also known as the 9-Grid Method) is a powerful visualization tool for goal achievement. It helps you break down a core theme into 8 sub-goals, which then branch out into 8 specific actions each, creating a total of 64 actionable steps.</p>
                    <p>Developed by Nova's Tool, this generator offers a free, ad-free, and highly customizable online experience.</p>
                    <h3>âœ¨ Key Features</h3>
                    <p>
                        <span class="feature-tag">Auto-Scatter Logic</span>
                        <span class="feature-tag">Smart Contrast Text</span>
                        <span class="feature-tag">Dopamine/Morandi Colors</span>
                        <span class="feature-tag">Mobile Optimized</span>
                    </p>
                    <h3>ğŸš€ How to Use</h3>
                    <ol>
                        <li><strong>Set Core Goal:</strong> Click the very center of the grid and enter your main goal or keyword for the year.</li>
                        <li><strong>Expand Sub-Goals:</strong> Enter 8 sub-goals in the cells surrounding the core goal. The system will automatically "scatter" these to the centers of the outer 3x3 blocks.</li>
                        <li><strong>Plan Actions:</strong> In each outer block, fill in the 8 specific actions required to achieve that sub-goal.</li>
                        <li><strong>Customize Style:</strong> Select a color from the palette, then click the center of any block to apply the color theme.</li>
                        <li><strong>Save Results:</strong> Click "Download" to save as a PNG image, or use "Export" to save a JSON file for future editing.</li>
                    </ol>
                `
            }
        };

        let currentLang = 'zh'; // Default Language
        
        let state = {
            blocks: Array(9).fill().map(() => ({ color: '#ffffff' })),
            cells: Array(81).fill('') 
        };

        const mainGrid = document.getElementById('mandala-container');
        const colorPicker = document.getElementById('colorPicker');

        function init() { 
            updateLanguageUI();
            renderGrid(); 
        }

        // --- å¤šèªç³»åˆ‡æ›é‚è¼¯ ---
        function toggleLanguage() {
            currentLang = currentLang === 'zh' ? 'en' : 'zh';
            updateLanguageUI();
            renderGrid(); // Re-render grid to update placeholders
        }

        function updateLanguageUI() {
            const t = translations[currentLang];
            // Update simple text elements
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (t[key]) el.innerHTML = t[key];
            });
            // Update HTML content (Guide)
            document.getElementById('guideSection').innerHTML = t.guideHTML;
            // Update Page Title
            document.title = currentLang === 'zh' 
                ? "æ›¼é™€ç¾…ä¹å®®æ ¼ç”Ÿæˆå™¨ (Mandala Chart)"
                : "Mandala Chart Generator";
        }

        function renderGrid() {
            mainGrid.innerHTML = '';
            const t = translations[currentLang];
            
            for (let i = 0; i < 81; i++) {
                const row = Math.floor(i / 9);
                const col = i % 9;
                const blockRow = Math.floor(row / 3);
                const blockCol = Math.floor(col / 3);
                const blockIndex = blockRow * 3 + blockCol;
                
                const innerRow = row % 3;
                const innerCol = col % 3;
                const cellIndexInBlock = innerRow * 3 + innerCol;

                const baseColor = state.blocks[blockIndex].color;
                let centerColor, surroundColor;
                if (baseColor.toLowerCase() === '#ffffff') {
                    centerColor = '#ffffff'; surroundColor = '#ffffff';
                } else {
                    centerColor = saturateColor(baseColor, 0.05);
                    surroundColor = lightenColor(baseColor, 0.87);
                }

                const isCenterOfBlock = (cellIndexInBlock === 4);
                let finalBgColor = isCenterOfBlock ? centerColor : surroundColor;

                const cell = document.createElement('div');
                cell.className = 'cell';
                
                if (col === 2 || col === 5) cell.classList.add('thick-right');
                if (row === 2 || row === 5) cell.classList.add('thick-bottom');

                cell.style.backgroundColor = finalBgColor;
                cell.style.color = getContrastYIQ(finalBgColor);

                const editableDiv = document.createElement('div');
                editableDiv.className = 'editable-div';
                editableDiv.contentEditable = "true";
                editableDiv.innerText = state.cells[i];
                
                // Placeholder Logic based on current language
                let placeholder = "";
                if (isCenterOfBlock) {
                    placeholder = (blockIndex === 4) ? t.coreGoal : t.subGoal;
                }
                editableDiv.setAttribute('data-placeholder', placeholder);
                
                editableDiv.id = `cell-${i}`;
                
                editableDiv.addEventListener('input', (e) => {
                    const newVal = e.target.innerText;
                    state.cells[i] = newVal;

                    if (blockIndex === 4 && !isCenterOfBlock) {
                        const targetBlockIndex = cellIndexInBlock; 
                        const targetBlockRow = Math.floor(targetBlockIndex / 3);
                        const targetBlockCol = targetBlockIndex % 3;
                        const globalTargetRow = targetBlockRow * 3 + 1;
                        const globalTargetCol = targetBlockCol * 3 + 1;
                        const targetGlobalIndex = globalTargetRow * 9 + globalTargetCol;

                        state.cells[targetGlobalIndex] = newVal;
                        const targetDiv = document.getElementById(`cell-${targetGlobalIndex}`);
                        if (targetDiv) targetDiv.innerText = newVal;
                    }
                });

                if (isCenterOfBlock) {
                    editableDiv.addEventListener('click', () => {
                        applyColorToBlock(blockIndex, colorPicker.value);
                    });
                } else {
                    cell.addEventListener('click', (e) => {
                         if (e.target === cell) editableDiv.focus();
                    });
                }

                cell.appendChild(editableDiv);
                mainGrid.appendChild(cell);
            }
        }

        colorPicker.addEventListener('input', (e) => { });
        function pickColor(color) { colorPicker.value = color; }

        function applyColorToBlock(blockIndex, color) {
            state.blocks[blockIndex].color = color;
            renderGrid();
            setTimeout(() => {
                const blockRow = Math.floor(blockIndex / 3);
                const blockCol = blockIndex % 3;
                const centerGlobalIndex = (blockRow * 3 + 1) * 9 + (blockCol * 3 + 1);
                
                const targetDiv = document.getElementById(`cell-${centerGlobalIndex}`);
                if (targetDiv) targetDiv.focus();
            }, 0);
        }

        function setFontSize(size) {
            const root = document.documentElement;
            document.querySelectorAll('#fontSizeControls button').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-fs-${size}`).classList.add('active');
            let newSize = '1rem';
            if (size === 's') newSize = varStyle('--font-size-s');
            if (size === 'm') newSize = varStyle('--font-size-m');
            if (size === 'l') newSize = varStyle('--font-size-l');
            if (size === 'xl') newSize = varStyle('--font-size-xl');
            root.style.setProperty('--current-font-size', newSize);
        }
        
        function varStyle(name) { return getComputedStyle(document.documentElement).getPropertyValue(name).trim(); }

        function downloadImage() {
            const container = document.getElementById('mandala-container');
            const editables = container.querySelectorAll('.editable-div');
            editables.forEach(el => el.contentEditable = "false");
            
            html2canvas(container, { scale: 3, backgroundColor: null, logging: false, useCORS: true }).then(canvas => {
                editables.forEach(el => el.contentEditable = "true");
                const link = document.createElement('a');
                link.download = 'Mandala_Chart.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }

        function exportData() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(state));
            const node = document.createElement('a');
            node.setAttribute("href", dataStr);
            node.setAttribute("download", "mandala_data.json");
            document.body.appendChild(node);
            node.click();
            node.remove();
        }

        function importData(input) {
            const t = translations[currentLang];
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const d = JSON.parse(e.target.result);
                    if (d && d.blocks && d.cells) { state = d; renderGrid(); alert(t.alertImportSuccess); } 
                    else alert(t.alertFormatError);
                } catch (er) { alert(t.alertFileError); }
                input.value = '';
            };
            reader.readAsText(file);
        }

        function saturateColor(hex, amount) {
            hex = hex.replace('#', '');
            let r = parseInt(hex.substring(0,2), 16);
            let g = parseInt(hex.substring(2,4), 16);
            let b = parseInt(hex.substring(4,6), 16);
            let hsl = rgbToHsl(r, g, b);
            hsl[1] = Math.min(1, Math.max(0, hsl[1] + amount));
            let rgb = hslToRgb(hsl[0], hsl[1], hsl[2]);
            return "#" + ((1 << 24) + (rgb[0] << 16) + (rgb[1] << 8) + rgb[2]).toString(16).slice(1);
        }

        function lightenColor(hex, amount) {
            hex = hex.replace('#', '');
            let r = parseInt(hex.substring(0,2), 16), g = parseInt(hex.substring(2,4), 16), b = parseInt(hex.substring(4,6), 16);
            r = Math.round(r + (255 - r) * amount);
            g = Math.round(g + (255 - g) * amount);
            b = Math.round(b + (255 - b) * amount);
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).padStart(6, '0');
        }

        function getContrastYIQ(hexcolor){
            hexcolor = hexcolor.replace("#", "");
            if (hexcolor.length === 3) hexcolor = hexcolor.split('').map(c => c + c).join('');
            var r = parseInt(hexcolor.substr(0,2),16);
            var g = parseInt(hexcolor.substr(2,2),16);
            var b = parseInt(hexcolor.substr(4,2),16);
            var yiq = ((r*299)+(g*587)+(b*114))/1000;
            return (yiq >= 160) ? '#334155' : '#ffffff'; 
        }

        function rgbToHsl(r, g, b) {
            r /= 255, g /= 255, b /= 255;
            var max = Math.max(r, g, b), min = Math.min(r, g, b);
            var h, s, l = (max + min) / 2;
            if (max == min) { h = s = 0; } else {
                var d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                switch (max) {
                    case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                    case g: h = (b - r) / d + 2; break;
                    case b: h = (r - g) / d + 4; break;
                }
                h /= 6;
            }
            return [h, s, l];
        }

        function hslToRgb(h, s, l) {
            var r, g, b;
            if (s == 0) { r = g = b = l; } else {
                function hue2rgb(p, q, t) {
                    if (t < 0) t += 1; if (t > 1) t -= 1;
                    if (t < 1/6) return p + (q - p) * 6 * t;
                    if (t < 1/2) return q;
                    if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
                    return p;
                }
                var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                var p = 2 * l - q;
                r = hue2rgb(p, q, h + 1/3);
                g = hue2rgb(p, q, h);
                b = hue2rgb(p, q, h - 1/3);
            }
            return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];
        }

        init();
    </script>
</body>
</html>